---

title:  "REVERSING 세계 입문"
excerpt: "C programming"
header:

categories:
  - C/C++
tags:
  - C/C++
---



C언어는 현재 2차원 배열로 테트리스 작성, printf 내장함수(라이브러리 직접 구현 포함) 구현 정도와 간단한 Makefile로 프로그래밍을 할 수 있는 약소한 초보자의 레벨입니다.  
제가 보안을 목표로 하게 된 건 개인적으로 평소에 프로그래밍을 공부라고 생각을 안해요.  
  
그냥 놀이로 이것저것 다 합니다. (물론 그 많은 분야를 다 깊게는 안파고 조금씩만 합니다.)  
  
C언어와 리눅스가 주축으로 굳어가는 와중에 리버싱이라는 존재를 봤습니다.  


흔히 말해서 역공학이라고 불리는 것...리버싱이죠. 해커가 되겠다고 접근한 건 아니고 재미로 이것저것 다 접해보다가 접하게 되었습니다.  

'hello world'와 'input/output'의 간단한 어셈블리 프로그램을 작성하기 시작하면서 흥미가 시작된 것 같네요.  

![helloworld](https://user-images.githubusercontent.com/75885992/130322769-f5b23786-9a60-408d-86cb-e8fd8cdb60a5.png)    

![인풋아웃풋](https://user-images.githubusercontent.com/75885992/130322770-ca479124-85c9-4653-aa30-effd4fd98568.png)   

C언어라는 녀석을 아직 깊게는 파지 못하였지만 어차피 현재진행형이고 리눅스랑 같이 겸해서 계속 공부중인 와중에 리버스 엔지니어링이라는 아주 흥미롭고 매력적인 녀석을 발견하였고, 곧 바로 공부하는 데에 궤도를 올리기로 하였습니다.^^  


처음에는 터미널창에  

```c
$ gdb ./main
```  

따위의 명령어로 일일이 찾아가면서 어셈블리어를 눈에 익혔다가....(왜냐면 어셈블리어 관련 명령어를 잘 몰랐거든요.)  

```c
$ objdump --disasaemble main  
```  

이라는 아주 좋은 녀석을 발견하여서  

  
```c
$ objdump -f main
```  

```  
$ objdump -R main
```  

이라는 두 녀석을 이용하여 스택의 순서와 첫 주소를 읽고 흐름을 읽는 연습을 시작하게 되었었습니다.  
  
그런데 매번 치기 귀찮더군요.  

  
그래서 아예 .asm 확장자 따위의 파일에 한 방에 이어쓰기 하면서 만들어주기 위해서  

```c
$ (objdump -f main) >> main.asm
$ (objdump -R main) >> main.asm
$ (objdump --disasaemble main) >> main.asm
```  

으로 하나의 파일로 통칭하고 읽는 용도의 어셈블리어 파일을 만들 수 있었습니다.  


이런 식으로 해서  
  
기본적인 32bit와 64bit의 차이를 익힐 수 있었네요.  

제가 컴퓨터가 두 개인데 한대는 윈도우고 한대는 아치리눅스 메인이에요. 그래서 각각의 bit 버전을 참고해가면서 어셈블리어를 관찰해봤는데, 32bit는 %eax 따위이고 64bit는 %rax 따위라는 것을 발견할 수 있었습니다.  
  
이런 것들이 배움의 즐거움이지요.  
  
![main함수](https://user-images.githubusercontent.com/75885992/130322806-78e5755d-a042-48f1-8973-7f64c54eaa5b.png)  
![main함수2](https://user-images.githubusercontent.com/75885992/130322809-b4dd7339-3b03-4988-a564-df21917d0a97.png)  
  
아무것도 모를때는 감각과 직관만으로 찾아가면서 흐름을 찾아서 배웠습니다.  

  
아, 윈도우에서의 디버거를 위한 준비물은 우선 DEV C++을 이용해 32비트 컴파일 환경을 셋팅하고 해주었습니다. 왜냐면 Ollydbg가 옛날 프로그램이라서 32bit아니면 실행자체가 안됬더군여.ㅠㅠ (아실만한 분은 다 아실테지만.)  

  
리버싱 서적의 3대장이라는 돋보기 / 나뭇잎 / 전갈 중에서 저는 나뭇잎 마을에서 발행한 책을 샀어요.  
  
리버싱쪽에서 유명한 것 같아보이는 서적인 '리버싱 핵심원리'입니다.  

  
그 책을 봐서 첫장을 집어들었는데 'IDA'에 관한 구문이 있었습니다.  
  
그래서 저의 리눅스에 당장 설치해서 사용을 해봤습니다.ㅋㅋㅋㅋㅋㅋㅋㅋ  

  
우선 윈도우의 디버거 프로그램 Ollydbg 이야기입니다.  

  
리눅스에서 명령어를 사용하여서 열어본 것과 주소와 스택순서, 어셈블리 용어 순서 자체는 똑같더군요.  
  
(주소를 수조라고 오타가 났습니다.ㅜㅜ)
  
![시작주소_같음](https://user-images.githubusercontent.com/75885992/130322819-d6fcce80-df6f-438b-8cb8-e95c38452909.png)    
  
요것 또한 일치했습니다.  
  
![시작주소_같음2](https://user-images.githubusercontent.com/75885992/130322847-3be17ddf-d90b-43ec-9442-f58920b7929b.png)    
  
물 론, Ollydbg의 툴 프로그램도 아주 훌륭한 것 같지만 우선 이 툴은 나뭇잎 마을의 닌자가 되기 위해서 구입한 책과 병행하여서 공부하기로 하는 용도로 하기로 하고.....  
  
  
최강의 툴이라는 IDA의 세계에 입성을 해봤습니다!!  

![11](https://user-images.githubusercontent.com/75885992/130322864-6c81733e-9888-4f5d-a9bf-bd02a610e18d.png)
![아이다putchar2](https://user-images.githubusercontent.com/75885992/130322861-2d55cb64-6ad5-4920-aa2c-bbefb1f3fe73.png)
![아이다putchar1](https://user-images.githubusercontent.com/75885992/130322862-047d5b83-919a-46b0-adb8-62fe2b626783.png)

리눅스에서 추출한 어셈블리어 정보와 IDA 프로그램을 비교한 사진.   
  
오호. 역시 리눅스와 동일하게 나옵니다.  
  
역시 스택순서나 용어 이런건 동일한 것 같아 직관적으로 분석을 하는데에 큰 어려움이 없을 것 같아 보이네요.  
  

뭐니해도 IDA 프로그램에서의 가장 맘에 드는 점은 어셈블리를 트리처럼 보여준 다는 겁니다.  
  
너무나 편하더라고요. 디컴파일 기능이 있다는 것은 처음 접했을때 상당한 충격이었습니다.(하지만 너무 의지를 하면 안되고 중간 중간에는 결국 어셈블리로 분석을 해야 되는 구간이 직감적으로 느껴지긴 했습니다.)  

  
우선 아래의 친구는 제가 직접 구현해본 printf를 Makefile로 구현해본 녀석인데,  

  
![프린트에프_수정](https://user-images.githubusercontent.com/75885992/130322886-c265da68-d0b0-4b18-bb8a-b5cae95ad9f3.png)  

  
요따위로 생성이 된 파일을 가져다가 열어보니....  
  
![신세계](https://user-images.githubusercontent.com/75885992/130322920-a9f06e3d-761e-4384-93ea-bd5fbd1ed436.png)  

![신세계2](https://user-images.githubusercontent.com/75885992/130322918-7fe7607d-954f-4b12-8559-4721e993a164.png)  
  
IDA 프로그램이 인기 있을 수 밖에 없는 이유는 이를 비롯한 최강의 기능들이 탑재되어있다는 점이다.  
(함수명을 주목해보세요.)
  
이렇게 보기 편하게 트리로 정리된 다는 것이 정말 신세계였고 큰 충격이었습니다....  
  
하지만 제가 아직 리버싱의 레벨이 낮아서 저것의 전부를 분석을 못해 다 분석을 해내겠다는 욕심이 생기고 있습니다.  
  
gdb로만 하다가 이렇게 보니 너무나 편하네요.  
  
  
밑에 __cdecl 따위의 구문은 검색을 해보니 이걸 정리해주신 분의 블로그를 찾아 포스팅을 캡처하고 주소와 함께 올려보도록 합니다.  

  
  
![function](https://user-images.githubusercontent.com/75885992/130322933-c9f1ad5c-42ff-4809-9fda-d371b21482cd.png)  
  
......단박에 이해가 가더군요.  
  
무언가 다른 세계의 C언어지만 가깝게 느껴지기도 했습니다.ㅎㅎ  




![C언어](https://user-images.githubusercontent.com/75885992/130322935-d782e3b3-49b5-40c3-811b-14b531f52877.png)  

분명 C언어긴 하지만 약간의 다른 문법으로 디컴파일이 되는 모습을 확인할 수 있다. 물론 직관적으로 비교해가면서 분석을 하는데에는 지장이 없을 것이라고 사료된다.  
  
리버싱 분야에 대해서도 앞으로 조금씩 조금씩 계속 공부를 해가면서 쌓아가고자 합니다.  
  
늦은 비전공자 학도지만 힘내보겠습니다!  

